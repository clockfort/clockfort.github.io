<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Clockfort's Tech Blog]]></title>
  <link href="http://clockfort.github.io/atom.xml" rel="self"/>
  <link href="http://clockfort.github.io/"/>
  <updated>2013-08-17T01:26:09-07:00</updated>
  <id>http://clockfort.github.io/</id>
  <author>
    <name><![CDATA[Chris Lockfort]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Making a Custom Linux Build]]></title>
    <link href="http://clockfort.github.io/blog/2013/08/16/making-a-custom-linux-build/"/>
    <updated>2013-08-16T15:33:00-07:00</updated>
    <id>http://clockfort.github.io/blog/2013/08/16/making-a-custom-linux-build</id>
    <content type="html"><![CDATA[<p>I&rsquo;m borrowing the OpenWRT project&rsquo;s surprisingly easy to use cross-compilation toolchain to make a custom 3.10 Linux kernel, ramdisk, and root image for this device. The end result isn&rsquo;t going to look anything like OpenWRT, though, more like a cross-Linux-from-Scratch install, since my needs are very different than normal OpenWRT uses (I am not limited to a horrid platform with ~16MB of flash, ~8MB of RAM, a single slow ARM CPU; I have GB/TB of disks, 4GB of RAM, 16 CPUs&hellip; and a weird architecture) so it&rsquo;s pretty much me having to cross-compile and build a root filesystem disk image of an entire standard linux distro from source for a fairly rare MIPS platform.</p>

<p>There are a lot of pains about this &ndash; kernel config is a little weird for this platform, and I found a few places that won&rsquo;t work (or even compile) for MIPS/Octeon platform. The kernel itself is easy, though, compared to building out a good-sized userspace for this platform. Some applications have x86/ARM/etc specific code and can&rsquo;t compile for MIPS; some applications have bad building dependency graphs and can&rsquo;t be built in parallel; other applications would work fine on MIPS, and compile reliably in parallel, but their trunk builds are currently broken for one reason or another. Or others use outdated kernel interfaces and can&rsquo;t build against 3.10 kernels.</p>

<p>So, as a result, the build process is:</p>

<ul>
<li>Do kernel config, select packages to build, add in a few extras that I&rsquo;ll need that aren&rsquo;t tracked by OpenWRT</li>
<li>Start building</li>
<li>Stop on an error</li>
<li>Fix error if it&rsquo;s a package I need, or toss out the application if it&rsquo;s a feature that is more of a &ldquo;would-be-nice&rdquo; than a &ldquo;must-have&rdquo;</li>
<li>Start building again with insane verbosity options enabled</li>
<li>Stop on an error&hellip; (repeat for hours and hours)</li>
</ul>


<p>Pro-tip: There are an absurd number of wireless kernel modules that don&rsquo;t compile/work on MIPS64. x86 binary firmware blobs are stupid.</p>

<p>After finding a kernel config with the maximum number of features I wanted (read: lots of weird networking / routing stuff, as well as heavy amounts of kernel debugging tool support) that didn&rsquo;t make my $(CC) barf all over the screen, and patching the build systems for a few applications I wanted to use (for some reason the HEAD of ISC&rsquo;s DHCPD has some non-gnu-make specific shit in it, among a few other things that are a little off), I finally managed to get a working bunch of build scripts. That said, the actual compilation process takes well over an hour on my i7, mostly due to restrictive -j1 settings on my part, because I was tired of dealing with a few packages that didn&rsquo;t properly enumerate their dependency graphs. This process also spits out over 50 MEGABYTES of logging to STDOUT/STDERR. No big deal.</p>

<p>I actually loaded an ELF binary of my 3.10 kernel build + an initrd in case things went to shit onto a small FAT boot partition on compact flash this time, rather than TFTPing, since these images are fairly large. I also placed an ext4 partition with a decently populated root environment on the CF card as well. Related to that ext4 partition &ndash; I had a few problems creating that as well. I wanted to have the smallest possible ext4 partition so if didn&rsquo;t have to copy much data over network/IDE to CF card/whatever, and wanted it to be later expandable, so I really pushed up the inode to block ratio in order to have a working filesystem that could support many files when it was later expanded. It didn&rsquo;t appreciate my initial settings (<code>genext2fs: too much overhead, try fewer inodes or more blocks.</code>) but I compromised a little and it gave in to what I wanted.</p>

<figure class='code'><figcaption><span>Kernel Log Snippet</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[  356.227919] Data bus error, epc == ffffffff8134a948, ra =
</span><span class='line'>= ffffffff8134a854
</span><span class='line'>[  356.234721] Oops[#1]:
</span><span class='line'>[  356.236986] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.10.0 #2
</span><span class='line'>[  356.242891] task: a80000003b840b38 ti: a80000003b844000 task.ti: a80000003b844000
</span><span class='line'>[  356.250358] $ 0   : 0000000000000000 0000000010108ce1 0000000000000000 00011b00f0081000
</span><span class='line'>[  356.258353] $ 4   : ffffffff814a0000 0000000000000000 0000000000000004 0000000000000002
</span><span class='line'>[  356.266347] $ 8   : a80000003b847ca0 0000000000000001 7669636520303030 303a30313a30392e
</span><span class='line'>[  356.274341] $12   : 0000000000000000 ffffffff8be48698 0000000000001000 0000000000000000
</span><span class='line'>[  356.282335] $16   : a80000003b8b6000 90011b00f0081000 000000000000001e 0000000000002edf
</span><span class='line'>[  356.290330] $20   : ffffffff8be40000 ffffffffffffffff 0000000000000040 ffffffff8be40000
</span><span class='line'>[  356.298324] $24   : 0000000000000001 0000000000000000
</span><span class='line'>[  356.306318] $28   : a80000003b844000 a80000003b847d10 ffffffff814ec4e0 ffffffff8134a854
</span><span class='line'>[  356.314313] Hi    : 0000000000000000
</span><span class='line'>[  356.317875] Lo    : 0000000000000000
</span><span class='line'>[  356.321458] epc   : ffffffff8134a948 quirk_usb_early_handoff+0x22c/0x730
</span><span class='line'>[  356.328129]     Not tainted
</span><span class='line'>[  356.330920] ra    : ffffffff8134a854 quirk_usb_early_handoff+0x138/0x730
</span><span class='line'>[  356.337600] Status: 10108ce3\0x09KX SX UX KERNEL EXL IE
</span><span class='line'>[  356.342553] Cause : 4080801c
</span><span class='line'>[  356.345422] PrId  : 000d0003 (Cavium Octeon)
</span><span class='line'>[  356.349678] Modules linked in:
</span><span class='line'>[  356.352725] Process swapper/0 (pid: 1, threadinfo=a80000003b844000, task=a80000003b840b38, tls=0000000000000000)
</span><span class='line'>[  356.362885] Stack : ffffffff81520000 ffffffff8141e2a0 a80000003b8b6090 ffffffff814c8030
</span><span class='line'>\0x09  ffffffff814c8048 a80000003b8b6000 000000000000ffff ffffffff8be40000
</span><span class='line'>\0x09  ffffffffffffffff 0000000000000040 ffffffff8be40000 ffffffff812e3b60
</span><span class='line'>\0x09  0000000000000010 a80000003b8b6000 0000000000000010 ffffffff8be80000
</span><span class='line'>\0x09  ffffffff81520000 ffffffff814a7b68 0000000000000006 ffffffff81543094
</span><span class='line'>\0x09  0000000000000000 ffffffff8137a410 ffffffff8be40000 ffffffff8154302c
</span><span class='line'>\0x09  0000000000000006 0000000000000000 ffffffff8be40000 ffffffff8110bae0
</span><span class='line'>\0x09  ffffffff8be40000 ffffffff81558e90 ffffffff81568888 0000000000000006
</span><span class='line'>\0x09  ffffffff81558e48 ffffffff8152fb0c ffffffff8be40000 0000000000000000
</span><span class='line'>\0x09  0000000000000000 0000000000000000 0000000000000000 0000000000000000
</span><span class='line'>\0x09  ...
</span><span class='line'>[  356.427883] Call Trace:
</span><span class='line'>[  356.430326] [&lt;ffffffff8134a948&gt;] quirk_usb_early_handoff+0x22c/0x730
</span><span class='line'>[  356.436672] [&lt;ffffffff812e3b60&gt;] pci_fixup_device+0x150/0x1ac
</span><span class='line'>[  356.442409] [&lt;ffffffff81543094&gt;] pci_apply_final_quirks+0x68/0x128
</span><span class='line'>[  356.448576] [&lt;ffffffff8110bae0&gt;] do_one_initcall+0x88/0x120
</span><span class='line'>[  356.454141] [&lt;ffffffff8152fb0c&gt;] kernel_init_freeable+0x140/0x1fc
</span><span class='line'>[  356.460221] [&lt;ffffffff811067c4&gt;] kernel_init+0x14/0x110
</span><span class='line'>[  356.465431] [&lt;ffffffff81100948&gt;] ret_from_kernel_thread+0x10/0x18
</span><span class='line'>[  356.471505]
</span><span class='line'>[  356.472980]
</span><span class='line'>Code: 2412001e  ae220008  8e220008 &lt;7c0210a0&gt; 00221402  c8400005  24040001  0c443ee2  2652ffff
</span><span class='line'>[  356.487055] ---[ end trace 2a21ae29f86033b8 ]---
</span></code></pre></td></tr></table></div></figure>


<p>Hahahahaha damn it.
Good news is, though, the PCI bus works perfectly, and it even loaded a network driver for a device! Also the RTC works. So I won&rsquo;t have to live in 1970. I wouldn&rsquo;t like that, they don&rsquo;t have cool MIPS machines yet.</p>

<p>Bad news is, besides the kernel oops from the USB implementation, is that while all 16 CPUs were detected properly (unlike OpenBSD), the heirarchical RCU (currently the default) I configured forced NUM_CPUS back down to 1 from 16. Oh well, easy enough to switch it to classic.</p>

<p>Anyways, we were running Linux on this Cavium Octeon based Lanner MR-950 for an entire 356 milliseconds, so I&rsquo;d call that a win.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Picky Software to go with Picky Hardware]]></title>
    <link href="http://clockfort.github.io/blog/2013/08/15/picky-hardware/"/>
    <updated>2013-08-15T17:46:00-07:00</updated>
    <id>http://clockfort.github.io/blog/2013/08/15/picky-hardware</id>
    <content type="html"><![CDATA[<p>Good news! Grabbed a snapshot kernel build from OpenBSD&rsquo;s trunk (currently only the development version, 5.4, has the beginnings of support for any Cavium SoCs at all) and managed to TFTPboot into that kernel and a small ramdisk.
I did have some problems; everyone on the internet seems to say that telling u-boot&rsquo;s TFTP client to download to memory address 0 is a sort of auto-find-an-address-that-won&rsquo;t-stomp-on-uboot&rsquo;s-own-memory, but this was not the case for me. Manually inserting an ELF binary (in this case, kernel + small ramdisk) at 0x21000000 and booting it with the ELF-binary loader (<code>bootoctlinux</code>) did work though. (I got the 0x21000000 address from whoever owned this board last, as there were some macros left in the preboot environment using that address)</p>

<p>&hellip; that&rsquo;s where the fun stops though.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>octcf0 at iobus0 base 0x1d000800 irq 0: Doesn&#39;t support 8bit card
</span><span class='line'>: card not present
</span></code></pre></td></tr></table></div></figure>


<p>(from OpenBSD/src/sys/arch/octeon/dev/octcf.c:)</p>

<figure class='code'><figcaption><span>OpenBSD/src/sys/arch/octeon/dev/octcf.c</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">uint64_t</span> <span class="n">cfg</span> <span class="o">=</span>
</span><span class='line'>  <span class="o">*</span><span class="p">(</span><span class="kt">uint64_t</span> <span class="o">*</span><span class="p">)</span><span class="n">PHYS_TO_XKPHYS</span><span class="p">(</span>
</span><span class='line'>      <span class="n">OCTEON_MIO_BOOT_BASE</span> <span class="o">+</span> <span class="n">MIO_BOOT_REG_CFG</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">CCA_NC</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">((</span><span class="n">cfg</span> <span class="o">&amp;</span> <span class="n">BOOT_CFG_BASE_MASK</span><span class="p">)</span> <span class="o">==</span>
</span><span class='line'>      <span class="p">(</span><span class="n">OCTEON_CF_BASE</span> <span class="o">&gt;&gt;</span> <span class="n">BOOT_CFG_BASE_SHIFT</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">((</span><span class="n">cfg</span> <span class="o">&amp;</span> <span class="n">BOOT_CFG_WIDTH_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;: Doesn&#39;t support 8bit card</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span class='line'>              <span class="n">wd</span><span class="o">-&gt;</span><span class="n">sc_dev</span><span class="p">.</span><span class="n">dv_xname</span><span class="p">);</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ARGH. The hardware can do it, but OpenBSD is so damn picky about what it will take. USB didn&rsquo;t come up on boot either, and neither did the SATA controller, and neither did the network, so my options of what to boot from are basically using u-boot to manually load ramdisks into ram and booting them&hellip; or nothing.</p>

<p>Also bad:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>cpu0 at mainbus0: Unknown CPU type (0x0) rev 0.3 499 MHz, Software FP emulation
</span><span class='line'>vendor &quot;Cavium&quot;, unknown product 0x0005 (class processor subclass MIPS, rev 0x03) at pci0 dev 0 function 0 not configured
</span><span class='line'>unsupported octeon model: 0xd0003
</span></code></pre></td></tr></table></div></figure>


<p>The OpenBSD kernel doesn&rsquo;t know what this processor is :&ndash;(  Also as a result it&rsquo;s using only two cores, and is software-emulating floating point instructions, since it doesn&rsquo;t know how to interact with the hardware.</p>

<p>Not the worst, mostly just annoying:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>0:0:0: mem address conflict 0x11000000/0x1000
</span><span class='line'>
</span><span class='line'>0:0:0: mem address conflict 0x18000000/0x8000000
</span><span class='line'>
</span><span class='line'>0:5:0: bridge mem address conflict 0x21000000/0x300000
</span><span class='line'>
</span><span class='line'>0:5:0: bridge mem address conflict 0x10000000/0x100000
</span><span class='line'>
</span><span class='line'>WARNING: No TOD clock, believing file system.
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ram Success!]]></title>
    <link href="http://clockfort.github.io/blog/2013/08/13/ram-success/"/>
    <updated>2013-08-13T20:23:00-07:00</updated>
    <id>http://clockfort.github.io/blog/2013/08/13/ram-success</id>
    <content type="html"><![CDATA[<p>Whoo! Got one of the two hard-to-find rare RAM sticks today (they shipped from different warehouses that each only had one stick left!). Stuck it in DIMM slot 0 (marked by &ldquo;J1&rdquo; on the PCB silkscreen) (the SoC apparently will not boot with memory only in DIMM1 slot) and everything worked great! The other 2GB (matched!) stick comes tomorrow.</p>

<p>Sure enough all that I needed was a slightly different chip configuration of RAM; this RAM is 8-bit wide rather than the previous easier to find ram with 4-bit width (higher density chip rank configuration).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>\0x00
</span><span class='line'>\0x00
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>U-Boot 1.1.1 (Development build) (Build time: Mar 15 2007 - 03:44:07)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>WARNING:
</span><span class='line'>WARNING: Measured DDR clock mismatch! expected: 266 MHz, measured: 196 MHz, cpu clock: 499 MHz
</span><span class='line'>WARNING: Using measured clock for configuration.
</span><span class='line'>WARNING:
</span><span class='line'>
</span><span class='line'>Warning: Clock descriptor tuple not found in eeprom, using defaults
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>WARNING: memory configured for 196 mhz clock.
</span><span class='line'>If this is not the actual memory clock
</span><span class='line'>poor performance and memory instability may result.
</span><span class='line'>The memory speed must be specified in the board eeprom
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Warning: Board descriptor tuple not found in eeprom, using defaults
</span><span class='line'>EBT3000 board revision major:1, minor:0, serial #: unknown
</span><span class='line'>OCTEON CN38XX-NSP revision: 3(pass 4), Core clock: 499 MHz, DDR clock: 196 MHz (392 Mhz data rate)
</span><span class='line'>
</span><span class='line'>DRAM:  2048 MB
</span><span class='line'>
</span><span class='line'>Flash: 16 MB
</span><span class='line'>Clearing DRAM.....
</span><span class='line'>.
</span><span class='line'>.
</span><span class='line'>.
</span><span class='line'>done
</span><span class='line'>BIST check passed.
</span><span class='line'>Starting PCI
</span><span class='line'>PCI Status: PCI-X 64-bit
</span><span class='line'>PCI BAR 1: Memory 0x80080000  PCI 0x18000000
</span><span class='line'>Net:   octeth0, octeth1, octeth2, octeth3, octeth4, octeth5, octeth6, octeth7
</span><span class='line'>Bus 0:
</span><span class='line'>OK
</span><span class='line'>
</span><span class='line'>  Device 0: Model: STEC M4 CF Firm: E6236-2 Ser#: STM000105607
</span><span class='line'>            Type: Hard Disk
</span><span class='line'>            Capacity: 14840.9 MB = 14.4 GB (30394224 x 512)
</span><span class='line'>Octeon ebt3000#
</span><span class='line'>help
</span><span class='line'>
</span><span class='line'>?       - alias for &#39;help&#39;
</span><span class='line'>askenv  - get environment variables from stdin
</span><span class='line'>autoscr - run script from memory
</span><span class='line'>base    - print or set address offset
</span><span class='line'>bootelf - Boot from an ELF image in memory
</span><span class='line'>bootoct - Boot from an Octeon Executive ELF image in memory
</span><span class='line'>bootoctelf - Boot a generic ELF image in memory. NOTE: This command does not support
</span><span class='line'>             simple executive applications, use bootoct for those.
</span><span class='line'>bootoctlinux - Boot from a linux ELF image in memory
</span><span class='line'>bootp   - boot image via network using BootP/TFTP protocol
</span><span class='line'>cmp     - memory compare
</span><span class='line'>coninfo - print console devices and informations
</span><span class='line'>cp      - memory copy
</span><span class='line'>crc32   - checksum calculation
</span><span class='line'>dhcp    - invoke DHCP client to obtain IP/boot params
</span><span class='line'>echo    - echo args to console
</span><span class='line'>eeprom  - EEPROM sub-system
</span><span class='line'>erase   - erase FLASH memory
</span><span class='line'>fatinfo - print information about filesystem
</span><span class='line'>fatload - load binary file from a dos filesystem
</span><span class='line'>fatloadalloc - load binary file from a dos filesystem, and allocate
</span><span class='line'>          a named bootmem block for file data
</span><span class='line'>fatls   - list files in a directory (default /)
</span><span class='line'>flinfo  - print FLASH memory information
</span><span class='line'>go      - start application at address &#39;addr&#39;
</span><span class='line'>gunzip  - Uncompress an in memory gzipped file
</span><span class='line'>help    - print online help
</span><span class='line'>ide     - IDE sub-system
</span><span class='line'>initflash - init flash when boot from Netrom
</span><span class='line'>itest\0x09 - return true/false on integer compare
</span><span class='line'>loadb   - load binary file over serial line (kermit mode)
</span><span class='line'>loop    - infinite loop on address range
</span><span class='line'>md      - memory display
</span><span class='line'>mii     - MII utility commands
</span><span class='line'>mm      - memory modify (auto-incrementing)
</span><span class='line'>mtest   - simple RAM test
</span><span class='line'>mw      - memory write (fill)
</span><span class='line'>namedalloc    - Allocate a named bootmem block
</span><span class='line'>namedfree    - Free a named bootmem block
</span><span class='line'>namedprint    - Print list of named bootmem blocks
</span><span class='line'>nm      - memory modify (constant address)
</span><span class='line'>pci     - list and access PCI Configuraton Space
</span><span class='line'>ping    - send ICMP ECHO_REQUEST to network host
</span><span class='line'>printenv- print environment variables
</span><span class='line'>protect - enable or disable FLASH write protection
</span><span class='line'>rarpboot- boot image via network using RARP/TFTP protocol
</span><span class='line'>read64    - read 64 bit word from 64 bit address
</span><span class='line'>read64b    - read 8 bit word from 64 bit address
</span><span class='line'>read_cmp    - read and compare memory to val
</span><span class='line'>reset   - Perform RESET of the CPU
</span><span class='line'>run     - run commands in an environment variable
</span><span class='line'>saveenv - save environment variables to persistent storage
</span><span class='line'>setenv  - set environment variables
</span><span class='line'>sleep   - delay execution for some time
</span><span class='line'>tftpboot- boot image via network using TFTP protocol
</span><span class='line'>tlv_eeprom  - EEPROM data parsing for ebt3000 board
</span><span class='line'>version - print monitor version
</span><span class='line'>write64    - write 64 bit word to 64 bit address
</span><span class='line'>write64b    - write 8 bit word to 64 bit address
</span><span class='line'>Octeon ebt3000#
</span><span class='line'>printenv
</span><span class='line'>
</span><span class='line'>bootdelay=0
</span><span class='line'>baudrate=115200
</span><span class='line'>download_baudrate=115200
</span><span class='line'>bootloader_flash_update_failsafe=protect off 0xbec00000 0xbec3FFFF;erase 0xbec00000 0xbec3FFFF;cp.b 0x100000 0xbec00000 0x40000
</span><span class='line'>bootloader_flash_update=protect off 0xbec40000 0xbec7ffff;erase 0xbec40000 0xbec7ffff;cp.b 0x100000 0xbec40000 0x40000
</span><span class='line'>linux_cf=fatload ide 0 21000000 vmlinux.64;bootoctlinux 21000000
</span><span class='line'>burn_app=erase bf480000 +$(filesize);cp.b 100000 bf480000 $(filesize)
</span><span class='line'>ls=fatls ide 0
</span><span class='line'>bf=bootoct bf480000 forceboot numcores=$(numcores)
</span><span class='line'>nuke_env=protect off BFBFE000 BFBFffff; erase BFBFE000 BFBFffff
</span><span class='line'>autoload=n
</span><span class='line'>octethethact=octeth0
</span><span class='line'>ipaddr=172.21.44.136
</span><span class='line'>turbo=tftpboot 0x21000000 turbo; bootoct 0x21000000 coremask=ffff
</span><span class='line'>serverip=172.21.44.134
</span><span class='line'>ethact=octeth4
</span><span class='line'>numcores=16
</span><span class='line'>stdin=serial
</span><span class='line'>stdout=serial
</span><span class='line'>stderr=serial
</span><span class='line'>
</span><span class='line'>Environment size: 775/131068 bytes
</span><span class='line'>Octeon ebt3000#
</span></code></pre></td></tr></table></div></figure>


<p>Bonus! Looks like the firmware shell is working fine, and it detects my compact flash card fine, so that should work well as an eventual boot media. Until then, I&rsquo;ll probably have to TFTP boot from one of the 8 gig network ports available in this pre-boot environment :&ndash;)</p>

<p>Next step: the hard parts! Creating a bootable disk image that u-boot can understand, and a usable *nix system root partition to live in.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SDK Troubles]]></title>
    <link href="http://clockfort.github.io/blog/2013/08/11/sdk-troubles/"/>
    <updated>2013-08-11T22:50:00-07:00</updated>
    <id>http://clockfort.github.io/blog/2013/08/11/sdk-troubles</id>
    <content type="html"><![CDATA[<p>Cavium apparently requires you to buy an expensive hardware development kit in order to get access to their SDK, which provides a simulator / base linux image / compiler for their platform. Bummer. After a while of digging though, a helpful wiki page from the FreeBSD MIPS team indicated that one may also petition to join a fairly closed-door community called <a href="http://cnusers.org/">cnUsers</a>, where approved members are allowed access to a pretty crippled occasionally released copy of the Cavium SDK. However, it does not offer advanced crypto/compression library support, and more importantly does not include the simulator/base linux image. 😢</p>

<p>Regardless, I have applied, and eagerly await evaluating what help, if any, the open source SDK will be in any porting efforts.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Hacking a Lanner MR-950]]></title>
    <link href="http://clockfort.github.io/blog/2013/08/11/hacking-a-lanner-mr-950/"/>
    <updated>2013-08-11T11:36:00-07:00</updated>
    <id>http://clockfort.github.io/blog/2013/08/11/hacking-a-lanner-mr-950</id>
    <content type="html"><![CDATA[<p>I recently bought a Lanner MR-950 &ldquo;Octeon Powered Security Appliance&rdquo; for super-cheaps off of ebay. It&rsquo;s a 16-core MIPS64 SoC with 10x 1-gig copper ports, DDR2 modules, dual redundant PSUs, etc.  (<a href="http://www.quantum.com.pl/baza/pdf/5f0ca0cc39ca9a492838d80453fc034ba5936ba3.pdf">Basic Datasheet</a>)</p>

<p>After consulting some chipset documentation to see what was supported, I also bought from eBay to populate the board 2x2GB DDR2-667 PC2-5300 ECC Registered DIMMs, and a 16GB compact flash card from someone on ebay kind enough to list read/write IOPS for their products :&ndash;)</p>

<p>Some excited pictures from receiving the item!
<img class="center" src="http://clockfort.github.io//blog.clockfort.com/images/posts/lanner_mr950.jpg" title="Lanner MR-950 on my couch" >
<img class="center" src="http://clockfort.github.io//blog.clockfort.com/images/posts/lanner_mr950_guts.jpg" title="Lanner MR-950's guts" ></p>

<p>&hellip; the dent in the LED panel above isn&rsquo;t an artifact of my wide-angle camera lens, this little guy has seen some action. With that done, now onto making him boot Linux.</p>

<p>I have some friends who work for / own a company that makes a neat custom <a href="https://www.exablox.com/products/">NAS solution on top of Cavium Octeon II SoCs</a>, and I happen to know that their boxes default to 115200bps serial for debugging, rather than the relatively industry-standard 9600/8/n/1. Sure enough, after this informed lucky guess on serial settings, after turning the box on (and finding the switch to turn off an ear-piercing alarm that I somehow triggered by booting the box), text started streaming in over my janky USB→DB9 Serial→Cisco rollover→RJ45→RJ45/DB9 console adapter setup.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>\0x00
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>U-Boot 1.1.1 (Development build) (Build time: Mar 15 2007
</span><span class='line'> - 03:44:07)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>WARNING:
</span><span class='line'>WARNING: Measured DDR clock mismatch! expected: 266 MHz, measured: 196 MHz, cpu clock: 499 MHz
</span><span class='line'>WARNING: Using measured clock for configuration.
</span><span class='line'>WARNING:
</span><span class='line'>
</span><span class='line'>Warning: Clock descriptor tuple not found in eeprom, using defaults
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>WARNING: memory configured for 196 mhz clock.
</span><span class='line'>If this is not the actual memory clock
</span><span class='line'>poor performance and memory instability may result.
</span><span class='line'>The memory speed must be specified in the board eeprom
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Warning: Board descriptor tuple not found in eeprom, using defaults
</span><span class='line'>EBT3000 board revision major:1, minor:0, serial #: unknown
</span><span class='line'>OCTEON CN38XX-NSP revision: 3(pass 4), Core clock: 499 MHz, DDR clock: 196 MHz (392 Mhz data rate)
</span><span class='line'>
</span><span class='line'>Unsupported SDRAM Width, 4.  Must be 8 or 16.
</span><span class='line'>hanging...
</span><span class='line'>##
</span><span class='line'># ERROR ### Please RESET the board ###
</span><span class='line'>
</span><span class='line'>~\0x00
</span></code></pre></td></tr></table></div></figure>


<p>Darn. I unfortunately understand this message, and it means I need to both:</p>

<ul>
<li>Somehow find and buy 240pin DDR2 DIMMs that are registered, ECC, 2GB or less, AND meet the new apparent requirement of also being &ldquo;low density&rdquo; (aka having a larger number of low-density chips rather than high-density ones, which will be accessed over a large data width). This will probably be difficult to find.</li>
<li>Either buy slower RAM (I don&rsquo;t want to do that!) or figure out how the ram speed is stored/encoded in the EEPROM and change it.</li>
</ul>


<p>Whelp. At least old DDR2 server ram is very cheap used, albeit it will be very difficult to find the particular combination of features I need (used RAM sellers aren&rsquo;t usually forthcoming about the exact chip configuration of their DIMMs&hellip;).</p>

<p>Stay tuned! I&rsquo;ll be back in around a week and a half, hopefully with much better news, after receiving some new RAM.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[New blog!]]></title>
    <link href="http://clockfort.github.io/blog/2013/08/11/new-blog/"/>
    <updated>2013-08-11T11:00:00-07:00</updated>
    <id>http://clockfort.github.io/blog/2013/08/11/new-blog</id>
    <content type="html"><![CDATA[<p>I may eventually port some posts over from the old site. Eventually. It may end up being too much busy work.</p>
]]></content>
  </entry>
  
</feed>
